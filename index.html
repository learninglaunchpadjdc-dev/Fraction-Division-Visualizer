<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Division Modeler | Tactical Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #020617;
            --panel-bg: #0f172a;
            --accent-blue: #3b82f6;
            --accent-amber: #fbbf24;
            --ui-border: #1e293b;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-deep); 
            color: #f8fafc; 
            overflow-x: hidden; 
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        .blueprint-bg {
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.5) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .fraction-input {
            background: #020617;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 8px;
            width: 64px;
            text-align: center;
            font-weight: bold;
            outline: none;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s;
        }
        
        .fraction-input:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        #divNum, #divDen { color: var(--accent-blue); border-color: rgba(59, 130, 246, 0.3); }
        #sorNum, #sorDen { color: var(--accent-amber); border-color: rgba(251, 191, 36, 0.3); }

        .tick-label { font-size: 11px; fill: #94a3b8; font-weight: 800; font-family: 'JetBrains Mono', monospace; }
        
        .arc-path { fill: none; stroke-width: 3; stroke-linecap: round; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .dividend-bar-fill { fill: rgba(59, 130, 246, 0.1); stroke: var(--accent-blue); stroke-width: 2.5; }
        .bar-partition { stroke: var(--accent-amber); stroke-width: 1.5; stroke-opacity: 0.4; }
        
        .handle { cursor: ew-resize; fill: #ffffff; stroke: var(--accent-blue); stroke-width: 3; transition: r 0.2s; }
        .handle:hover { r: 10; fill: var(--accent-blue); }

        .kcf-box {
            @apply flex flex-col items-center justify-center p-2 rounded bg-slate-800/50 border border-slate-700 min-w-[50px];
        }

        .math-symbol { @apply text-slate-500 font-bold px-2; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="h-16 border-b border-slate-800 bg-[#0f172a] flex items-center justify-between px-8 sticky top-0 z-50">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-slate-700 rounded flex items-center justify-center shadow-lg">
                <i data-lucide="layers" class="text-white w-6 h-6"></i>
            </div>
            <div>
                <h1 class="text-xl font-black tracking-tighter text-white uppercase">Visual <span class="text-slate-400">Partition</span> Engine</h1>
                <p class="text-[10px] mono text-slate-500 uppercase tracking-[0.2em]">KCF Computation Strategy Enabled</p>
            </div>
        </div>
        <div id="topResult" class="text-lg font-black mono text-white px-4 py-1 bg-slate-800 rounded">0.00</div>
    </header>

    <main class="flex-1 p-8 grid grid-cols-1 lg:grid-cols-12 gap-8 max-w-[1600px] mx-auto w-full">
        
        <!-- Sidebar Controls -->
        <div class="lg:col-span-3 space-y-6">
            <!-- Dividend Panel -->
            <section class="bg-blue-500/5 border border-blue-500/20 rounded-xl p-6 shadow-xl">
                <h3 class="text-[10px] font-bold text-blue-400 uppercase tracking-[0.2em] mb-4 flex items-center gap-2">
                    <i data-lucide="box" class="w-4 h-4"></i> Dividend
                </h3>
                <div class="flex items-center gap-4">
                    <div class="flex flex-col gap-2">
                        <input id="divNum" type="number" value="3" min="0" oninput="updateFromInputs()" class="fraction-input">
                        <div class="h-[2px] bg-blue-500/30 rounded"></div>
                        <input id="divDen" type="number" value="12" min="1" oninput="updateFromInputs()" class="fraction-input">
                    </div>
                </div>
            </section>

            <!-- Divisor Panel -->
            <section class="bg-amber-500/5 border border-amber-500/20 rounded-xl p-6 shadow-xl">
                <h3 class="text-[10px] font-bold text-amber-500 uppercase tracking-[0.2em] mb-4 flex items-center gap-2">
                    <i data-lucide="scissors" class="w-4 h-4"></i> Divisor
                </h3>
                <div class="flex items-center gap-4">
                    <div class="flex flex-col gap-2">
                        <input id="sorNum" type="number" value="1" min="0" oninput="updateFromInputs()" class="fraction-input">
                        <div class="h-[2px] bg-amber-500/30 rounded"></div>
                        <input id="sorDen" type="number" value="4" min="1" oninput="updateFromInputs()" class="fraction-input">
                    </div>
                </div>
            </section>

            <!-- KCF Strategy Panel -->
            <section class="bg-slate-900 border border-slate-800 rounded-xl p-6 shadow-xl">
                <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center gap-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4 text-green-500"></i> KCF Strategy Model
                </h3>
                
                <div class="flex flex-wrap items-center justify-between gap-2">
                    <!-- Keep -->
                    <div class="flex flex-col items-center">
                        <span class="text-[8px] text-blue-400 font-bold mb-1">KEEP</span>
                        <div class="kcf-box border-blue-500/30">
                            <span id="kcf-k-n" class="text-xs font-bold text-blue-400">3</span>
                            <div class="w-full h-[1px] bg-slate-700 my-1"></div>
                            <span id="kcf-k-d" class="text-xs font-bold text-blue-400">12</span>
                        </div>
                    </div>
                    
                    <span class="math-symbol">Ã—</span>

                    <!-- Change/Flip -->
                    <div class="flex flex-col items-center">
                        <span class="text-[8px] text-green-400 font-bold mb-1">FLIP</span>
                        <div class="kcf-box border-green-500/30">
                            <span id="kcf-f-n" class="text-xs font-bold text-green-400">4</span>
                            <div class="w-full h-[1px] bg-slate-700 my-1"></div>
                            <span id="kcf-f-d" class="text-xs font-bold text-green-400">1</span>
                        </div>
                    </div>

                    <span class="math-symbol">=</span>

                    <!-- Result -->
                    <div class="flex flex-col items-center">
                        <span class="text-[8px] text-slate-400 font-bold mb-1">PROD</span>
                        <div class="kcf-box">
                            <span id="kcf-r-n" class="text-xs font-bold">12</span>
                            <div class="w-full h-[1px] bg-slate-700 my-1"></div>
                            <span id="kcf-r-d" class="text-xs font-bold">12</span>
                        </div>
                    </div>
                </div>

                <div class="mt-4 p-2 bg-black/40 rounded border border-slate-800 text-[10px] mono text-slate-500 leading-relaxed">
                    By flipping the divisor, we transform division into multiplication by the reciprocal.
                </div>
            </section>
        </div>

        <!-- Canvas -->
        <div class="lg:col-span-9 flex flex-col gap-6">
            <div class="bg-[#0f172a] border border-slate-800 rounded-2xl p-10 shadow-2xl relative select-none blueprint-bg overflow-hidden min-h-[500px]">
                <div id="canvasPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-slate-600 pointer-events-none hidden">
                    <i data-lucide="mouse-pointer-2" class="w-12 h-12 mb-4 opacity-20"></i>
                    <p class="mono text-xs uppercase tracking-[0.3em]">Enter values to generate visualizer</p>
                </div>

                <svg id="visualizer" viewBox="0 0 800 350" class="w-full h-auto overflow-visible mt-12">
                    <line x1="50" y1="280" x2="750" y2="280" stroke="#334155" stroke-width="2" />
                    <g id="gridLayer"></g>
                    <g id="barLayer"></g>
                    <g id="jumpLayer"></g>
                    <g id="labelLayer"></g>
                    <circle id="dragHandle" cx="50" cy="80" r="9" class="handle" />
                </svg>
            </div>

            <div class="bg-slate-900/50 border border-slate-800 p-8 rounded-xl flex items-center justify-between">
                <div>
                    <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-2">Analysis Engine</h4>
                    <p id="explanationText" class="text-slate-500 text-sm max-w-md">Calculating partitions...</p>
                </div>
                <div class="text-right">
                    <span class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em]">Quotient</span>
                    <div id="resultBox" class="text-5xl font-black text-white">0.0</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const svg = document.getElementById('visualizer');
        const placeholder = document.getElementById('canvasPlaceholder');
        const gridLayer = document.getElementById('gridLayer');
        const barLayer = document.getElementById('barLayer');
        const jumpLayer = document.getElementById('jumpLayer');
        const labelLayer = document.getElementById('labelLayer');
        const dragHandle = document.getElementById('dragHandle');

        let currentDividendValue = 0;
        let isDragging = false;

        function gcd(a, b) { return b ? gcd(b, a % b) : a; }

        function formatFraction(val, den) {
            if (val === 0) return "0";
            const num = Math.round(val * den);
            const common = gcd(num, den);
            const resNum = num/common;
            const resDen = den/common;
            return resDen === 1 ? `${resNum}` : `${resNum}/${resDen}`;
        }

        function updateFromInputs() {
            const dn = parseFloat(document.getElementById('divNum').value) || 0;
            const dd = parseFloat(document.getElementById('divDen').value) || 1;
            currentDividendValue = dn / dd;
            render();
        }

        function render() {
            const dn = parseInt(document.getElementById('divNum').value) || 0;
            const dd = parseInt(document.getElementById('divDen').value) || 1;
            const sn = parseInt(document.getElementById('sorNum').value) || 0;
            const sd = parseInt(document.getElementById('sorDen').value) || 1;
            const divisor = sn / sd;

            if (dn === 0 && sn === 0) {
                svg.classList.add('hidden');
                placeholder.classList.remove('hidden');
                return;
            }

            svg.classList.remove('hidden');
            placeholder.classList.add('hidden');

            let maxScale = Math.max(currentDividendValue * 1.3, divisor * 1.3, 1.5);
            maxScale = Math.ceil(maxScale * 2) / 2;
            const unitWidth = 700 / maxScale;

            gridLayer.innerHTML = '';
            labelLayer.innerHTML = '';
            barLayer.innerHTML = '';
            jumpLayer.innerHTML = '';

            // Update KCF UI
            document.getElementById('kcf-k-n').innerText = dn;
            document.getElementById('kcf-k-d').innerText = dd;
            document.getElementById('kcf-f-n').innerText = sd; // Flip
            document.getElementById('kcf-f-d').innerText = sn; // Flip
            document.getElementById('kcf-r-n').innerText = dn * sd;
            document.getElementById('kcf-r-d').innerText = dd * sn;

            // Ticks
            for (let i = 0; i <= maxScale * sd; i++) {
                const x = 50 + (i * (unitWidth / sd));
                if (x > 755) break;
                const isWhole = i % sd === 0;
                gridLayer.innerHTML += `
                    <line x1="${x}" y1="${isWhole ? 270 : 275}" x2="${x}" y2="${isWhole ? 290 : 285}" 
                          stroke="${isWhole ? '#64748b' : 'var(--accent-amber)'}" 
                          stroke-width="${isWhole ? 2 : 1.5}" 
                          stroke-opacity="${isWhole ? 1 : 0.5}" />
                `;
                if (isWhole || sd <= 8) {
                    labelLayer.innerHTML += `<text x="${x}" y="315" text-anchor="middle" class="tick-label">${formatFraction(i/sd, sd)}</text>`;
                }
            }

            // Dividend Bar
            const barWidth = currentDividendValue * unitWidth;
            if (barWidth > 0) {
                let barHtml = `<rect x="50" y="60" width="${barWidth}" height="40" class="dividend-bar-fill" rx="4" />`;
                for (let i = 1; i < currentDividendValue * sd; i++) {
                    const px = 50 + (i * (unitWidth / sd));
                    barHtml += `<line x1="${px}" y1="60" x2="${px}" y2="100" class="bar-partition" />`;
                }
                barHtml += `<text x="${50 + barWidth/2}" y="85" text-anchor="middle" fill="#60a5fa" class="text-[10px] font-black mono">${formatFraction(currentDividendValue, dd)}</text>`;
                barLayer.innerHTML = barHtml;
                dragHandle.setAttribute('cx', 50 + barWidth);
            }

            // Jumps
            let quotient = 0;
            if (divisor > 0) {
                let currX = 0;
                while (currX + divisor <= currentDividendValue + 0.0001) {
                    const x1 = 50 + (currX * unitWidth);
                    const x2 = 50 + ((currX + divisor) * unitWidth);
                    jumpLayer.innerHTML += `<path d="M ${x1} 280 Q ${(x1+x2)/2} 230 ${x2} 280" class="arc-path" stroke="var(--accent-amber)" />`;
                    currX += divisor;
                }
                if (currX < currentDividendValue - 0.0001) {
                    const x1 = 50 + (currX * unitWidth);
                    const x2 = 50 + (currentDividendValue * unitWidth);
                    jumpLayer.innerHTML += `<path d="M ${x1} 280 Q ${(x1+x2)/2} 250 ${x2} 280" class="arc-path" stroke="#334155" stroke-dasharray="4 2" />`;
                }
                quotient = currentDividendValue / divisor;
            }

            document.getElementById('topResult').innerText = quotient.toFixed(2);
            document.getElementById('resultBox').innerText = quotient.toFixed(2);
            document.getElementById('explanationText').innerHTML = divisor > 0 
                ? `Multiplying <span class="text-blue-400 font-bold">${dn}/${dd}</span> by the reciprocal <span class="text-green-400 font-bold">${sd}/${sn}</span> confirms the visual mapping.`
                : `Define a divisor to see the KCF model.`;
        }

        dragHandle.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const rect = svg.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 800;
            const sd = parseInt(document.getElementById('sorDen').value) || 12;
            const sn = parseInt(document.getElementById('sorNum').value) || 1;
            const divisor = sn / sd;
            let maxScale = Math.max(currentDividendValue * 1.3, divisor * 1.3, 1.5);
            maxScale = Math.ceil(maxScale * 2) / 2;
            const unitWidth = 700 / maxScale;
            currentDividendValue = Math.max(0, (x - 50) / unitWidth);
            document.getElementById('divNum').value = Math.round(currentDividendValue * 12);
            document.getElementById('divDen').value = 12;
            render();
        });

        window.onload = () => { lucide.createIcons(); updateFromInputs(); };
    </script>
</body>
</html>
